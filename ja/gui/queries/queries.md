# 検索バーとクエリインターフェイス

調査は、自動スクリプトからの電子メールアラートや、ダッシュボード上でユーザーが何かおかしいことに気づいたときに始まるかもしれませんが、実際の*データ探査*では、通常、手動でクエリを実行し、さまざまな時間枠とクエリを繰り返して、関心のある情報を掘り下げることになります。実際にクエリを構築する方法については、[検索ドキュメント](#!search/search.md)を参照してください。

## 新規検索ページ

"新しい検索"ページは、Gravwellユーザーのデフォルトのホームページです。また、UIの左上にあるGravwellロゴをクリックするか、メインメニューを開いて "新しい検索 "を選択することでもアクセスできます。

![](searchbar.png)

このページでは、0から完全に新しい検索を入力したり、以前の検索を再実行したり、クエリライブラリから検索をロードしたりすることができます。また、希望する時間枠を選択し、オプションでクエリのライブアップデートを有効にすることもできます。

### 手動で検索を入力

完全に0から検索を実行するには、単に入力を開始します。`tag=* stats count by TAG | chart count by TAG`のような有効なクエリを入力すると、"Search Now "と "Background Search "ボタンが有効になります。この時点で、これらのボタンのいずれかをクリックするか、"Enter "を押すことでクエリを起動することができます。

### 検索履歴へのアクセス

以前の検索を再実行するには、下向き矢印をクリックするか、検索バーの右端にあるリストアイコンをクリックします:

![](search-hist.png)

履歴リストから目的の検索をクリックします。これで履歴のドロップダウンが折りたたまれます。

### クエリライブラリへのアクセス

クエリライブラリに保存されているクエリは、検索バーからも利用できます。検索バーの右端にあるリストアイコンをクリックして検索履歴にアクセスし、ドロップダウンの下にある "クエリライブラリ"をクリックして表示を切り替えます:

![](search-library.png)

## タイムフレームの選択

デフォルトでは、クエリはデータの最後の1時間にわたって実行されます。これは、クエリバーの下にあるタイムフレームドロップダウンで簡単に変更できます:

![](timeframe.png)

"直近1時間 "を選択すると、現在の秒からちょうど1時間前までの時間のスパンでクエリが実行されます。9:22に検索を開始した場合、8:22から9:22までのデータを対象としたクエリが実行されます。"直近24時間 "や "直近1週間 "なども同様に動作します。

一方、"1時間 "を選択すると、*直近の時間の先頭*から現在まで検索が実行されます。したがって、9:22に検索を開始した場合、9:00から9:22までのデータが検索対象となります。"今日"、"今週"、"今月 "なども同様に動作します。"昨日 "は、前の暦日の00:00から23:59までのデータを検索する特殊なケースです。

「日付範囲」オプションを選択すると、以下のように開始日時と終了日時のセレクタが表示されます。

![](daterange.png)

同様に、"Unixタイムスタンプ "はUnixタイムスタンプ(エポックからの秒数)を手動で入力できるフィールドを提供します:

![](unix.png)

"カスタム期間 "では、過去何年、何ヶ月、何日、何時間、何分、何秒で検索を実行するかを入力することができます。下のスクリーンショットでは、ユーザーは過去2日、3時間、12分で検索したいと表示しています:

![](custom.png)

最後に、「ISO 8601 duration」では、[ISO-8601形式]（https://en.wikipedia.org/wiki/ISO_8601#Durations）で期間を指定することができます。下のスクリーンショットでは、ユーザーは「P13DT」と入力しています:

![](iso8601.png)

注意: "日時指定 "と "Unixタイムスタンプ"は、未来を検索するために使用することができ、これは、データが悪いタイムスタンプで取り込まれた場合に便利です。

## 検索結果ページ

クエリを実行すると、Gravwellは出力を表示するために*検索結果ページ*を表示します。このページから、結果のサブセクションへのドリルダウン、クエリの修正と再実行、タイムフレームの変更、結果の保存などを行うことができます。

![](results.png)

上のスクリーンショットにあるように、検索結果ページには現在のクエリがページの上部に表示されています。このボックスでクエリを編集してから、虫眼鏡のアイコンをクリックしてクエリを再実行することができます。別の時間枠を使用したい場合は、再実行する前にカレンダーアイコンを使用して別の時間枠を選択してください。

また、履歴/ライブラリドロップダウンアイコンを使用して、検索履歴またはクエリライブラリのいずれかからクエリを完全に変更することもできます。

検索結果ページには、以下に示すように、ページ右側の3つの縦のドットをクリックすることでアクセスできる、検索結果の追加アクションのメニューもあります。このメニューの各オプションについては、以下のサブセクションで説明します。

![](menu.png)

### 結果の保存

このオプションは、検索をSAVEDとしてマークします。検索結果は、ユーザーが検索を削除するまで、[持続的検索] ページでアクセスできます。

### クエリの保存

現在の検索結果をクエリライブラリに保存し、後で再利用できるようにします。

![](savequery.png)

### ダッシュボードに追加

このオプションを使用すると、既存のダッシュボードに検索を追加したり、この検索を最初のタイルとして新しいダッシュボードを作成することができます。ダッシュボードを検索」フィールドを使用して、既存のダッシュボードをフィルタリングして適切なダッシュボードを見つけることができます。

![](add-to-dash.png)

### バックグラウンドに送信

このオプションは、検索が完了するまでに予想以上に時間がかかる場合に便利です。「バックグラウンドに送信」をクリックすると、検索結果ページから離れて移動した後もバックグラウンドで検索が実行されます。これにより、検索が完了している間に他のことを行うことができます。検索のステータスを監視し、[持続的検索]ページから完了した結果を表示することができます。バックグラウンド検索は、ウェブサーバの再起動時にも持続しないことに注意してください。

### スケジュール

"スケジュール "をクリックすると、現在のクエリがクエリフィールドにあらかじめ入力された状態で、新しいスケジュール検索ページに移動します。タイムフレームセレクターは、可能であれば、最近実行したタイムフレームと一致するように設定されます。スケジュール検索に名前、説明、スケジュールを与え、保存をクリックします。

![](schedule.png)

### ダウンロード

「ダウンロード」メニューでは、検索結果を様々な形式でダウンロードするためのオプションを提供しています。

![](download.png)

上のスクリーンショットでは、チャートのレンダラーはJSONとCSV形式を提供しています。例えば、CSV形式のチャートをダウンロードしてスプレッドシートにインポートすると便利です。

特に有用な組み合わせは、[raw renderer](#!search/raw/raw.md)からJSON結果をダウンロードすることです。結果として得られたファイルは、Gravwellの[reimport ingester](https://github.com/gravwell/gravwell/tree/master/ingesters/reimport)を使って、同じエントリを別のGravwellインスタンスに再インジェストすることができます。問題についてGravwellのサポートにメールを送ると、テストのためにこの形式でエントリを送るように要求されるかもしれません。

### クエリURLを共有

「クエリのURLを共有」オプションを選択すると、コピーして他のユーザーに貼り付けることができるURLを表示するダイアログが表示されます。URLを開くと、先ほど実行したのと同じクエリが再実行されます。他の人が自分の画面を見に来られない時に、データを見せるのに便利な方法です。

![](share.png)

### テンプレートの開始

「テンプレートを開始する」オプションは、現在のクエリがあらかじめ入力された状態で新規テンプレートページを開きます。テンプレートは、基本的には*変数*を含むGravwellに保存されたクエリです。これらは、調査ダッシュボードを構築するために、またはアクションアブルと組み合わせて、以前の検索結果の一部に基づいてクエリを起動するために使用されます。テンプレート、アクショナブル、および調査ダッシュボードについては、別の場所で説明しています。

![](template.png)

## タイムフレームのサブ選択

多くのクエリでは、Gravwellは検索結果の上にタイムフレームのサブ選択インターフェイスを表示します。これは小さなチャートで、x軸がクエリのタイムフレームをカバーし、y軸がエントリ数を表します。

![](timeframe.png)

上のスクリーンショットでは、エントリーが時間枠（6月7日16:41から6月8日14:41まで）にわたってかなり均一に分布していることがわかります。次のスクリーンショットは、エントリーのよりまばらな分布を示しており、エントリーが全く表示されていない時間がいくつかあります:

![](timeframe-sparse.png)

タイムフレームセレクターを使用して、検索結果の一部を拡大することができます。例えば、ここでは過去1時間の検索結果を示しています:

![](dhcp-top.png)

タイムフレームセレクター上でマウスの左ボタンをクリックしたままにすると、タイムフレームの一部を強調表示することができます。マウスボタンを離すと、Gravwellは選択された部分をズームインし、クエリを再実行することなく、適切な結果を再計算します:

![](dhcp-zoomed.png)

複数回、最小のズームレベル（元のクエリのタイムフレームによって決定される）までズームインすることができます。この時点でGUIはタイムフレームセレクターに2つの新しいボタンを追加します。矢印ボタンはズームレベルを1段階下げてくれます。" x "ボタンはズームを完全にキャンセルし、元のクエリのタイムフレームに戻ります。

クエリバーのタイムフレームボタンにドットが付いていることに注意してください。これは、この時点でクエリを再実行すると、*現在選択されているタイムフレーム*の上で実行されることを示しています。これは、幅広い結果のセットから開始して、特定のエリアをドリルダウンしたい場合に非常に便利です。

注意 : すべてのクエリがタイムフレームセレクタを表示するわけではありません。いくつかのモジュールやモジュールオプション（テーブルレンダラの `-nt` フラグなど）は、Gravwellを強制的に*非テンポラルモード*にして、ズームを無効にします。

## ライブアップデートクエリ

Gravwellに新しいエントリが入ってきたときに結果を更新しながら、特定のクエリを追跡したい場合は、ライブアップデート機能を使用することができます。新しい検索ページで "ライブアップデート "のトグルボタンをクリックするか、検索結果ページのタイムフレームドロップダウンメニューを使ってオンにして検索を再実行することができます。

![](live-new.png)

![](live-results.png)

ライブアップデートを有効にした検索は、指定された間隔で再実行され、結果が更新されます。そのため、大量のデータを含む検索（実行に長い時間がかかる）はライブアップデートには適していないかもしれません。

検索でライブアップデートが有効になっている場合、検索結果ページに2つの新しいボタンが追加されます:

![](live-buttons.png)

左側のボタン、"更新を一時停止 "と表示されている場合は、一時的にライブ更新を無効にします。再度クリックすると、更新が再び有効になります。

右のボタンでは、ライブアップデートの発生頻度を変更することができます:

![](live-options.png)

デフォルトでは、検索は1分ごとに更新されます。10秒ごとに更新することもできますし、お好みの頻度で更新することもできます。